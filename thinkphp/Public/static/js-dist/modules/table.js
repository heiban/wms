define(["jquery","underscore"],function(t,e){function n(n,a,i){function r(){var e=t(s);e.unbind("click").on("click",function(n){var a=t(n.currentTarget),r=a.attr("data-index");e.removeClass(i),a.addClass(i),o&&o(c[r])}),d&&t(m).one("click",function(e){var n=t(e.currentTarget),a=n.attr("data-index"),i=n.attr("data-type");d&&d(a,i)})}var c=[],d=null,i=i?i:"active",s=n+" tr[data-index]",l=n+" tr[class='"+i+"']",m=n+" span[data-index]",u=this,o=null;this.selectedIndex=function(){var e=t(l);return 1==e.length?e.attr("data-index"):-1},this.selectedItem=function(){var t=u.selectedIndex();return t>-1?c[t]:null},this.deleteItem=function(t){-1!=t&&(c.splice(t,1),u.render(c))},this.addItem=function(t){c.push(t),u.render(c)},this.data=function(){return c},this.click=function(t){o=t},this.render=function(i){i&&(c=i);var d="<tr><% _.each(colNames,function(item){%><th><%=item.name%></th><%});%></tr>",s='<tr data-index="<%=itemIndex%>"><% _.each(colNames,function(item){if(item.param.indexOf("op-")>-1){%><td><span data-index="<%=itemIndex%>" data-type="<%=item.param%>"><%=itemData[item.param]%></span></td><%}else{%><td><%=itemData[item.param]%></td><%}});%></tr>';t(n).html(""),t(n).append(e.template(d)({colNames:a})),t(c).each(function(i,r){t(n).append(e.template(s)({colNames:a,itemData:r,itemIndex:i}))}),r()},this.reset=function(){t(s).removeClass("active")},this.clear=function(){t(n).html("")},this.setOpCallback=function(t){d=t,u.render()}}return n});